{% load i18n %}
{% load url from future%}

{% if stack %}
  {% if stack.is_deleting or stack.is_delete_failed or stack.is_deploying or stack.is_failed %}
    <div class="row">
      <div class="col-xs-12">
        <div class="alert alert-info">
          <div class="row">
            <div class="col-xs-2">
              <strong>
                {% if stack.is_deleting %}
                  Undeploying...
                {% elif stack.is_delete_failed %}
                  Undeploying failed
                {% elif stack.is_deploying %}
                  Deploying...
                {% elif stack.is_failed %}
                  Deployment failed
                {% endif %}
              </strong>
              <div class="progress progress-striped progress-danger">
                <div class="bar bar-info" style="width:{{ progress }}%"></div>
              </div>
            </div>
            <div class="col-xs-10">
              {% if last_failed_events %}
                <strong>{% trans "Last failed events:" %}</strong>
                {% for event in last_failed_events %}
                <div>
                  <dl>
                    <dt>{% trans "Timestamp" %}</dt>
                    <dd><time datetime="{{ event.event_time }}">{{ event.event_time }}</time></dd>
                    <dt>{% trans "Resource Name" %}</dt>
                    <dd>{{ event.resource_name }}</dd>
                    <dt>{% trans "Status" %}</dt>
                    <dd>{{ event.resource_status }}</dd>
                    <dt>{% trans "Reason" %}</dt>
                    <dd>{{ event.resource_status_reason }}</dd>
                  </dl>
                </div>
                {% endfor %}
              {% endif %}
              <a href="{% url 'horizon:infrastructure:history:index' %}" class="pull-right">See full log</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  {% endif %}

  {% if stack.is_deployed and not stack.is_initialized %}
    <div class="row">
      <div class="col-xs-12">
        <div class="alert alert-info">
          <div class="row">
            <div class="col-xs-2">
              <span class="text-success" style="font-size: x-large; vertical-align:middle">
                <i class="glyphicon glyphicon-warning-sign"></i>
              </span>
            </div>
            <div class="col-xs-10">
              <p>{% trans "Your OpenStack cloud is deployed but it needs to get initialized in order to get live." %}</p>
              <a href="{% url 'horizon:infrastructure:overview:post_deploy_init' %}"
                 class="btn btn-primary ajax-modal">
                 {% trans "Initialize" %}
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  {% else %}
    Deployment is live
    <div class="widget">
      <h2>{% trans "Access Information" %}</h2>
      {% for dashboard_url in dashboard_urls %}
        <p>
          <a href="{{ dashboard_url }}">
            {% trans "Horizon URL" %} ({{ dashboard_url }})
          </a>
        </p>
      {% endfor %}
    </div>
  {% endif %}
  <hr>


    <a href="{% url 'horizon:infrastructure:overview:undeploy_confirmation' %}"
       class="btn btn-danger ajax-modal">
      <i class="glyphicon glyphicon-fire"></i>
      {% trans "Undeploy" %}
    </a>
{% else %}
  <h4>
      <span class="text-success" style="font-size: x-large; vertical-align:middle">
          <i class="glyphicon glyphicon-ok-circle"></i>
      </span>
      {% trans "Ready to get deployed" %}
  </h4>
  <a href="{% url 'horizon:infrastructure:overview:deploy_confirmation' %}"
   class="btn btn-danger ajax-modal">
    <i class="glyphicon glyphicon-cloud-upload"></i>
    {% trans "Deploy" %}
  </a>
{% endif %}
